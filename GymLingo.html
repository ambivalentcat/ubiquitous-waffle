<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymLingo Pro: –¢—Ä–µ–Ω–∞–∂–µ—Ä –ê–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #FAFAF9; /* warm gray 50 */
            color: #1C1917; /* warm gray 900 */
        }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }

        /* Card Flip Animation */
        .card-perspective { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            will-change: transform; /* Performance optimization */
        }
        .is-flipped .card-inner { transform: rotateY(180deg); }
        .card-face {
            /* Keep absolute positioning deterministic for both sides of the 3D flip card. */
            position: absolute !important;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem; /* rounded-3xl */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1);
        }
        .card-back { transform: rotateY(180deg); background: #fff; }
        .card-front { background: white; border: 1px solid #F5F5F4; }

        /* Smooth Fade In */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #D6D3D1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #A8A29E; }
    </style>
    <!-- Chosen Palette: "Modern Clean" - Stone/White base with Vibrant Amber & Slate accents for focus and energy. -->
</head>
<body class="min-h-screen flex flex-col selection:bg-amber-200 selection:text-amber-900">

    <!-- Navigation / Header (Glassmorphism) -->
    <header class="glass-nav fixed top-0 w-full z-50 border-b border-stone-200/50 transition-all duration-300">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-3xl">üèãÔ∏è</span>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-stone-800 to-stone-600 bg-clip-text text-transparent tracking-tight">GymLingo <span class="text-amber-500 text-sm font-medium uppercase tracking-widest align-top ml-1">Pro</span></h1>
            </div>
            <nav class="hidden md:flex space-x-1 bg-stone-100/50 p-1 rounded-full border border-stone-200/50">
                <button onclick="scrollToSection('dashboard')" class="px-5 py-2 rounded-full text-sm font-medium text-stone-600 hover:bg-white hover:text-amber-600 hover:shadow-sm transition-all">–û–±–∑–æ—Ä</button>
                <button onclick="scrollToSection('dictionary')" class="px-5 py-2 rounded-full text-sm font-medium text-stone-600 hover:bg-white hover:text-amber-600 hover:shadow-sm transition-all">–°–ª–æ–≤–∞—Ä—å</button>
                <button onclick="scrollToSection('trainer')" class="px-5 py-2 rounded-full text-sm font-medium text-stone-600 hover:bg-white hover:text-amber-600 hover:shadow-sm transition-all">–¢—Ä–µ–Ω–∞–∂–µ—Ä</button>
            </nav>
        </div>
    </header>

    <main class="flex-grow pt-28 pb-12 max-w-6xl mx-auto px-4 sm:px-6 w-full space-y-20">

        <!-- Hero / Intro -->
        <section class="text-center space-y-4 mb-12 fade-in">
            <h2 class="text-4xl md:text-5xl font-bold text-stone-900 leading-tight">
                –ì–æ–≤–æ—Ä–∏ –≤ –∑–∞–ª–µ <span class="text-amber-500">—É–≤–µ—Ä–µ–Ω–Ω–æ</span>
            </h2>
            <p class="text-lg text-stone-500 max-w-2xl mx-auto">
                –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–π –ª–µ–∫—Å–∏–∫–∏ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω–æ–≥–æ –∑–∞–ª–∞. 
                –£—á–∏—Ç–µ —Å–ª–æ–≤–∞, —Ç—Ä–µ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å.
            </p>
        </section>

        <!-- Section 1: Dashboard (Interactive Chart) -->
        <section id="dashboard" class="scroll-mt-32 fade-in" style="animation-delay: 0.1s;">
            <div class="bg-white rounded-3xl p-8 shadow-xl shadow-stone-200/50 border border-stone-100">
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <!-- Chart -->
                    <div class="w-full md:w-1/2 relative">
                        <div class="chart-container">
                            <canvas id="vocabChart"></canvas>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div class="text-center bg-white/90 backdrop-blur-sm p-3 rounded-2xl shadow-sm border border-stone-100">
                                <span class="block text-3xl font-bold text-stone-800" id="total-count">0</span>
                                <span class="text-xs text-stone-500 uppercase tracking-wide font-medium">–í—Å–µ–≥–æ —Ñ—Ä–∞–∑</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Context & Stats -->
                    <div class="w-full md:w-1/2 space-y-6">
                        <div>
                            <h3 class="text-2xl font-bold text-stone-800 mb-2">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h3>
                            <p class="text-stone-500 text-sm">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–µ–∫—Ç–æ—Ä –¥–∏–∞–≥—Ä–∞–º–º—ã, —á—Ç–æ–±—ã –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div onclick="filterByClick('general')" class="cursor-pointer group p-4 rounded-2xl bg-amber-50 border border-amber-100 hover:bg-amber-100 transition-colors">
                                <div class="text-2xl mb-1">üó£Ô∏è</div>
                                <div class="font-bold text-stone-800 group-hover:text-amber-700">–û–±—â–µ–Ω–∏–µ</div>
                                <div class="text-sm text-stone-500" id="stat-general-count">0 —Ñ—Ä–∞–∑</div>
                            </div>
                            <div onclick="filterByClick('exercises')" class="cursor-pointer group p-4 rounded-2xl bg-blue-50 border border-blue-100 hover:bg-blue-100 transition-colors">
                                <div class="text-2xl mb-1">üí™</div>
                                <div class="font-bold text-stone-800 group-hover:text-blue-700">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</div>
                                <div class="text-sm text-stone-500" id="stat-exercises-count">0 —Ñ—Ä–∞–∑</div>
                            </div>
                            <div onclick="filterByClick('process')" class="cursor-pointer group p-4 rounded-2xl bg-emerald-50 border border-emerald-100 hover:bg-emerald-100 transition-colors">
                                <div class="text-2xl mb-1">‚è±Ô∏è</div>
                                <div class="font-bold text-stone-800 group-hover:text-emerald-700">–ü—Ä–æ—Ü–µ—Å—Å</div>
                                <div class="text-sm text-stone-500" id="stat-process-count">0 —Ñ—Ä–∞–∑</div>
                            </div>
                            <div onclick="filterByClick('muscles')" class="cursor-pointer group p-4 rounded-2xl bg-purple-50 border border-purple-100 hover:bg-purple-100 transition-colors">
                                <div class="text-2xl mb-1">ü¶µ</div>
                                <div class="font-bold text-stone-800 group-hover:text-purple-700">–ú—ã—à—Ü—ã</div>
                                <div class="text-sm text-stone-500" id="stat-muscles-count">0 —Ñ—Ä–∞–∑</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Smart Dictionary -->
        <section id="dictionary" class="scroll-mt-32 fade-in" style="animation-delay: 0.2s;">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-stone-800">–£–º–Ω—ã–π –°–ª–æ–≤–∞—Ä—å</h2>
                    <p class="text-stone-500 mt-1">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã. –ù–∞–∂–º–∏—Ç–µ <span class="inline-flex items-center justify-center w-6 h-6 bg-stone-200 rounded-full text-xs">üîä</span> —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å.</p>
                </div>
                <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                    <div class="relative group">
                        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ñ—Ä–∞–∑—ã..." 
                            class="w-full sm:w-64 pl-10 pr-4 py-3 bg-white border border-stone-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all">
                        <span class="absolute left-3 top-3.5 text-stone-400 group-focus-within:text-amber-500 transition-colors">üîç</span>
                    </div>
                    <select id="categoryFilter" class="px-4 py-3 bg-white border border-stone-200 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-amber-500/50 cursor-pointer hover:border-amber-300 transition-all">
                        <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="general">–û–±—â–∏–µ —Ñ—Ä–∞–∑—ã</option>
                        <option value="exercises">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
                        <option value="process">–ü—Ä–æ—Ü–µ—Å—Å</option>
                        <option value="muscles">–ú—ã—à—Ü—ã</option>
                    </select>
                </div>
            </div>

            <div id="dictionaryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                <!-- JS Injected Cards -->
            </div>
            
            <div id="noResults" class="hidden flex flex-col items-center justify-center py-16 text-center text-stone-400 bg-white rounded-3xl border border-stone-100 border-dashed">
                <span class="text-4xl mb-2">üòï</span>
                <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É.</p>
            </div>
        </section>

        <!-- Section 3: Flashcard Trainer -->
        <section id="trainer" class="scroll-mt-32 mb-12 fade-in" style="animation-delay: 0.3s;">
            <div class="bg-stone-900 rounded-[2.5rem] p-8 md:p-12 text-white shadow-2xl relative overflow-hidden">
                <!-- Decorative blurred orbs -->
                <div class="absolute top-0 right-0 w-64 h-64 bg-amber-500/20 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-500/20 rounded-full blur-3xl -ml-16 -mb-16 pointer-events-none"></div>

                <div class="relative z-10 max-w-2xl mx-auto text-center">
                    <span class="inline-block py-1 px-3 rounded-full bg-white/10 border border-white/20 text-xs font-semibold tracking-wider uppercase mb-4 text-amber-300">–†–µ–∂–∏–º –û–±—É—á–µ–Ω–∏—è</span>
                    <h2 class="text-3xl font-bold mb-8">–§–ª—ç—à-–∫–∞—Ä—Ç–æ—á–∫–∏</h2>
                    
                    <!-- Trainer Controls -->
                    <div class="flex justify-between items-center text-sm font-medium text-stone-400 mb-4 px-2">
                        <div class="flex items-center gap-2">
                            <span>–ö–∞—Ä—Ç–æ—á–∫–∞ <span id="currentCardNum" class="text-white">1</span> / <span id="totalCardsNum">0</span></span>
                            <span class="w-1 h-1 bg-stone-600 rounded-full"></span>
                            <span id="categoryBadgeTrainer" class="text-amber-400">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                        </div>
                        <button onclick="resetLearned()" class="hover:text-white transition-colors text-xs underline decoration-stone-600 hover:decoration-white">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                    </div>

                    <!-- Progress Bar -->
                    <div class="w-full h-1.5 bg-white/10 rounded-full mb-8 overflow-hidden">
                        <div id="progressBar" class="h-full bg-gradient-to-r from-amber-400 to-orange-500 transition-all duration-300" style="width: 0%"></div>
                    </div>

                    <!-- The Card -->
                    <div class="h-80 w-full mb-8 cursor-pointer group card-perspective" onclick="flipCard()">
                        <div class="card-inner" id="flashcard">
                            <!-- Front -->
                            <div class="card-face card-front overflow-hidden">
                                <div class="absolute top-0 left-0 w-full h-1 bg-stone-100"></div>
                                <div class="text-5xl mb-6 opacity-80 grayscale">üá∑üá∫</div>
                                <h3 id="cardRu" class="text-2xl md:text-3xl font-bold text-stone-800 mb-2 px-4">...</h3>
                                <p class="text-stone-400 text-sm mt-auto pb-6 flex items-center gap-2">
                                    <span class="w-4 h-4 rounded-full border border-stone-300 flex items-center justify-center text-[10px]">‚ê£</span>
                                    –ü—Ä–æ–±–µ–ª –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞
                                </p>
                            </div>
                            <!-- Back -->
                            <div class="card-face card-back overflow-hidden">
                                <div class="absolute top-0 left-0 w-full h-1 bg-amber-500"></div>
                                <div class="absolute top-4 right-4">
                                    <button id="cardAudioBtn" onclick="playAudioFromCard(event)" class="w-10 h-10 rounded-full bg-amber-50 hover:bg-amber-100 text-amber-600 flex items-center justify-center transition-colors">
                                        üîä
                                    </button>
                                </div>
                                <div class="text-5xl mb-4 opacity-80 grayscale">üá¨üáß</div>
                                <h3 id="cardEn" class="text-2xl md:text-3xl font-bold text-stone-900 mb-2 px-4">...</h3>
                                <p id="cardTrans" class="text-lg text-amber-600 italic font-medium mb-6">...</p>
                                <button id="markLearnedBtn" onclick="markAsLearned(event)" class="mb-4 px-4 py-2 bg-stone-100 hover:bg-green-100 hover:text-green-700 text-stone-500 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                    <span>‚úÖ</span> –Ø –≤—ã—É—á–∏–ª —ç—Ç–æ
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="completionState" class="hidden mt-4 p-6 rounded-2xl border border-emerald-200 bg-emerald-50 text-emerald-800">
                        <div class="text-4xl mb-2">üéâ</div>
                        <h3 class="text-xl font-bold mb-2">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</h3>
                        <p class="text-emerald-700">–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏.</p>
                        <button onclick="resetLearned()" class="mt-4 px-5 py-2.5 bg-emerald-600 text-white rounded-xl shadow hover:bg-emerald-700 transition">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>

                    <!-- Buttons -->
                    <div class="flex justify-center items-center gap-4">
                        <button onclick="prevCard()" class="w-14 h-14 rounded-full bg-white/10 hover:bg-white/20 border border-white/10 text-white flex items-center justify-center transition-all backdrop-blur-md active:scale-95" title="–ù–∞–∑–∞–¥ (–°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ)">
                            ‚Üê
                        </button>
                        <button onclick="shuffleCards()" class="px-6 h-14 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 text-stone-300 text-sm font-medium transition-all backdrop-blur-md flex items-center gap-2">
                            <span>üîÄ</span> –ü–µ—Ä–µ–º–µ—à–∞—Ç—å
                        </button>
                        <button onclick="nextCard()" class="w-14 h-14 rounded-full bg-amber-500 hover:bg-amber-400 text-stone-900 flex items-center justify-center shadow-lg shadow-amber-500/20 transition-all active:scale-95" title="–í–ø–µ—Ä–µ–¥ (–°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ)">
                            ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-stone-200 py-10">
        <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center text-sm text-stone-500 gap-4">
            <div>
                <span class="font-bold text-stone-800">GymLingo Pro</span> ‚Ä¢ Interactive Learning
            </div>
            <div class="text-center md:text-right">
                <p>Generated for Canvas ‚Ä¢ 2024</p>
                <p class="text-xs mt-1">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ üéß –Ω–∞—É—à–Ω–∏–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–ø—ã—Ç–∞</p>
            </div>
        </div>
    </footer>

    <script>
        // --- DATA ---
        const gymData = [
            { ru: "–í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ?", en: "Are you okay?", trans: "–ê—Ä —é –æ—É–∫–µ–π?", category: "general" },
            { ru: "–°–¥–µ–ª–∞–ª?", en: "Done?", trans: "–î–∞–Ω?", category: "general" },
            { ru: "–°–∫–æ–ª—å–∫–æ –µ—â—ë?", en: "How many more?", trans: "–•–∞—É –º—ç–Ω–∏ –º–æ—Ä?", category: "general" },
            { ru: "–£—Å—Ç–∞–ª?", en: "Tired?", trans: "–¢–∞–π—ç—Ä–¥?", category: "general" },
            { ru: "–¢—è–∂–µ–ª–æ?", en: "Too heavy?", trans: "–¢—É —Ö–µ–≤–∏?", category: "general" },
            { ru: "–õ–µ–≥–∫–æ?", en: "Easy?", trans: "–ò–∑–∏?", category: "general" },
            { ru: "–ï—â—ë –¥–æ–±–∞–≤–∏–º", en: "Let‚Äôs add more", trans: "–õ—ç—Ç—Å —ç–¥–¥ –º–æ—Ä", category: "general" },
            { ru: "–ñ–∏–º —à—Ç–∞–Ω–≥–∏", en: "Barbell bench press", trans: "–ë–∞—Ä–±—ç–ª –±—ç–Ω—á –ø—Ä–µ—Å—Å", category: "exercises" },
            { ru: "–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π", en: "Dumbbell bench press", trans: "–î–∞–º–±—ç–ª –±—ç–Ω—á –ø—Ä–µ—Å—Å", category: "exercises" },
            { ru: "–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫", en: "Biceps curls", trans: "–ë–∞–π—Å–µ–ø—Å –∫—ë—Ä–ª–∑", category: "exercises" },
            { ru: "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫", en: "Triceps extensions", trans: "–¢—Ä–∞–π—Å–µ–ø—Å —ç–∫—Å—Ç—ç–Ω—à–Ω–∑", category: "exercises" },
            { ru: "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ", en: "Bent-over barbell row", trans: "–ë—ç–Ω—Ç –æ—É–≤–µ—Ä –±–∞—Ä–±—ç–ª —Ä–æ—É", category: "exercises" },
            { ru: "–¢—è–≥–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞", en: "Lat pulldown", trans: "–õ—ç—Ç –ø—É–ª–¥–∞—É–Ω", category: "exercises" },
            { ru: "–¢—è–≥–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞", en: "Seated cable row", trans: "–°–∏—Ç–∏–¥ –∫—ç–π–±–ª —Ä–æ—É", category: "exercises" },
            { ru: "–î–µ–ª–∞–π –ø–æ–¥—Ö–æ–¥", en: "Do a set", trans: "–î—É —ç —Å–µ—Ç", category: "exercises" },
            { ru: "–î–µ–ª–∞—Ç—å —Ä–∞—Å—Ç—è–∂–∫—É", en: "Do stretching", trans: "–î—É —Å—Ç—Ä—ç—á–∏–Ω–≥", category: "exercises" },
            { ru: "9‚Äì15 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π", en: "9‚Äì15 reps", trans: "–ù–∞–π–Ω —Ç—É —Ñ–∏—Ñ—Ç–∏–Ω —Ä–µ–ø—Å", category: "process" },
            { ru: "–û—Ç–¥—ã—Ö –ø–∞—Ä—É –º–∏–Ω—É—Ç", en: "Rest a couple of minutes", trans: "–†–µ—Å—Ç —ç –∫–∞–ø–ª –æ–≤ –º–∏–Ω—É—Ç—Å", category: "process" },
            { ru: "–î–æ–±–∞–≤–ª—è—Ç—å –≤–µ—Å", en: "Add weight", trans: "–≠–¥–¥ —É—ç–π—Ç", category: "process" },
            { ru: "–ö–∞—á–∞–µ–º –Ω–æ–≥–∏", en: "We‚Äôre training legs", trans: "–£–∏—ç—Ä —Ç—Ä—ç–π–Ω–∏–Ω–≥ –ª—ç–≥–∑", category: "muscles" },
            { ru: "–ö–∞—á–∞–µ–º —Å–ø–∏–Ω—É", en: "We‚Äôre training back", trans: "–£–∏—ç—Ä —Ç—Ä—ç–π–Ω–∏–Ω–≥ –±—ç–∫", category: "muscles" },
            { ru: "–ö–∞—á–∞–µ–º –≥—Ä—É–¥—å", en: "We‚Äôre training chest", trans: "–£–∏—ç—Ä —Ç—Ä—ç–π–Ω–∏–Ω–≥ —á—ç—Å—Ç", category: "muscles" },
            { ru: "–ö–∞—á–∞–µ–º –ø–ª–µ—á–∏", en: "We‚Äôre training shoulders", trans: "–£–∏—ç—Ä —Ç—Ä—ç–π–Ω–∏–Ω–≥ —à–æ—É–ª–¥—ç—Ä–∑", category: "muscles" },
            { ru: "–ö–∞—á–∞–µ–º —Ä—É–∫–∏", en: "We‚Äôre training arms", trans: "–£–∏—ç—Ä —Ç—Ä—ç–π–Ω–∏–Ω–≥ –∞—Ä–º–∑", category: "muscles" }
        ];

        // --- STATE ---
        let state = {
            currentCardIndex: 0,
            activeCards: [...gymData], // Cards not yet "learned"
            learnedCards: [],
            filterCategory: 'all',
            searchQuery: ''
        };

        const config = {
            colors: {
                general: '#f59e0b', // amber-500
                exercises: '#3b82f6', // blue-500
                process: '#10b981', // emerald-500
                muscles: '#a855f7'  // purple-500
            },
            labels: {
                general: "–û–±—â–∏–µ —Ñ—Ä–∞–∑—ã",
                exercises: "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è",
                process: "–ü—Ä–æ—Ü–µ—Å—Å",
                muscles: "–ú—ã—à—Ü—ã"
            }
        };

        // --- CHART ---
        let vocabChart;

        function initChart() {
            const counts = { general: 0, exercises: 0, process: 0, muscles: 0 };
            gymData.forEach(item => counts[item.category]++);

            // Update HTML Stats
            document.getElementById('total-count').textContent = gymData.length;
            document.getElementById('stat-general-count').textContent = counts.general;
            document.getElementById('stat-exercises-count').textContent = counts.exercises;
            document.getElementById('stat-process-count').textContent = counts.process;
            document.getElementById('stat-muscles-count').textContent = counts.muscles;

            const ctx = document.getElementById('vocabChart').getContext('2d');
            
            vocabChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.values(config.labels),
                    datasets: [{
                        data: Object.values(counts),
                        backgroundColor: Object.values(config.colors),
                        borderWidth: 0,
                        hoverOffset: 15,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%', // Thinner ring
                    layout: { padding: 20 },
                    onClick: (evt, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const categoryKeys = Object.keys(config.labels);
                            const selectedCategory = categoryKeys[index];
                            filterByClick(selectedCategory);
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#fff',
                            titleColor: '#1c1917',
                            bodyColor: '#57534e',
                            borderColor: '#e7e5e4',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.chart._metasets[context.datasetIndex].total;
                                    const percentage = Math.round((value / total) * 100) + '%';
                                    return ` ${value} —Ñ—Ä–∞–∑ (${percentage})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- DICTIONARY ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        }

        function filterByClick(category) {
            state.filterCategory = category;
            document.getElementById('categoryFilter').value = category;
            renderDictionary();
            scrollToSection('dictionary');
        }

        function renderDictionary() {
            const grid = document.getElementById('dictionaryGrid');
            const noResults = document.getElementById('noResults');
            
            grid.innerHTML = '';
            
            const filtered = gymData.filter(item => {
                const matchesCat = state.filterCategory === 'all' || item.category === state.filterCategory;
                const searchLower = state.searchQuery.toLowerCase();
                const matchesSearch = item.ru.toLowerCase().includes(searchLower) || 
                                      item.en.toLowerCase().includes(searchLower);
                return matchesCat && matchesSearch;
            });

            if (filtered.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                filtered.forEach((item, index) => {
                    const card = document.createElement('div');
                    // Staggered animation based on index
                    card.style.animationDelay = `${index * 0.05}s`;
                    card.className = 'fade-in bg-white p-6 rounded-2xl border border-stone-100 shadow-sm hover:shadow-lg hover:border-amber-200 transition-all duration-300 group';
                    
                    const catColor = config.colors[item.category];
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-bold text-stone-800 text-lg leading-tight">${item.ru}</h3>
                            <button onclick="speak('${item.en.replace(/'/g, "\\'")}')" class="text-stone-300 hover:text-amber-500 transition-colors p-1" title="–ü—Ä–æ—Å–ª—É—à–∞—Ç—å">
                                üîä
                            </button>
                        </div>
                        <p class="text-stone-800 font-medium text-lg mb-1 group-hover:text-amber-600 transition-colors">${item.en}</p>
                        <div class="flex justify-between items-center mt-3 pt-3 border-t border-stone-50">
                            <p class="text-stone-400 italic text-sm font-light">${item.trans}</p>
                            <span class="text-[10px] px-2 py-1 rounded-full font-bold uppercase tracking-wide opacity-70" style="background-color: ${catColor}20; color: ${catColor}">
                                ${config.labels[item.category]}
                            </span>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        // --- TRAINER ---
        function updateTrainerUI() {
            const cardContainer = document.getElementById('flashcard').parentElement;
            const completionState = document.getElementById('completionState');
            const audioBtn = document.getElementById('cardAudioBtn');
            const markLearnedBtn = document.getElementById('markLearnedBtn');

            if (state.activeCards.length === 0) {
                cardContainer.classList.remove('is-flipped');
                completionState.classList.remove('hidden');
                audioBtn.classList.add('hidden');
                markLearnedBtn.classList.add('hidden');

                document.getElementById('cardRu').textContent = '–í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã';
                document.getElementById('cardEn').textContent = 'Great job! Session complete.';
                document.getElementById('cardTrans').textContent = '–ù–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ¬ª, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.';
                document.getElementById('categoryBadgeTrainer').textContent = '–ì–æ—Ç–æ–≤–æ';
                document.getElementById('currentCardNum').textContent = 0;
                document.getElementById('totalCardsNum').textContent = 0;
                document.getElementById('progressBar').style.width = '100%';
                return;
            }

            const item = state.activeCards[state.currentCardIndex];
            const cardEl = document.getElementById('flashcard');
            completionState.classList.add('hidden');
            audioBtn.classList.remove('hidden');
            markLearnedBtn.classList.remove('hidden');
            
            // Reset Flip
            cardEl.parentElement.classList.remove('is-flipped');

            // Set Content
            setTimeout(() => {
                document.getElementById('cardRu').textContent = item.ru;
                document.getElementById('cardEn').textContent = item.en;
                document.getElementById('cardTrans').textContent = item.trans;
                
                // Badge
                const badge = document.getElementById('categoryBadgeTrainer');
                badge.textContent = config.labels[item.category];
                badge.style.color = config.colors[item.category];
                
                // Counters & Progress
                document.getElementById('currentCardNum').textContent = state.currentCardIndex + 1;
                document.getElementById('totalCardsNum').textContent = state.activeCards.length;
                
                const progress = ((state.currentCardIndex + 1) / state.activeCards.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
            }, 200);
        }

        function flipCard() {
            if (state.activeCards.length === 0) return;
            const cardContainer = document.getElementById('flashcard').parentElement;
            cardContainer.classList.toggle('is-flipped');
        }

        function nextCard() {
            if (state.activeCards.length === 0) return;
            state.currentCardIndex = (state.currentCardIndex + 1) % state.activeCards.length;
            updateTrainerUI();
        }

        function prevCard() {
            if (state.activeCards.length === 0) return;
            state.currentCardIndex = (state.currentCardIndex - 1 + state.activeCards.length) % state.activeCards.length;
            updateTrainerUI();
        }

        function playAudioFromCard(e) {
            e.stopPropagation(); // Prevent flip
            if (state.activeCards.length === 0) return;
            const text = state.activeCards[state.currentCardIndex].en;
            speak(text);
        }

        function markAsLearned(e) {
            e.stopPropagation(); // Prevent flip
            if (state.activeCards.length === 0) return;
            const learnedItem = state.activeCards.splice(state.currentCardIndex, 1)[0];
            state.learnedCards.push(learnedItem);
            
            // Adjust index if it was the last card
            if (state.currentCardIndex >= state.activeCards.length) {
                state.currentCardIndex = 0;
            }
            
            updateTrainerUI();
        }

        function resetLearned() {
            state.activeCards = [...gymData]; // Reset to full list
            state.learnedCards = [];
            state.currentCardIndex = 0;
            shuffleCards();
            // Re-render handled by shuffle
        }

        function shuffleCards() {
            for (let i = state.activeCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [state.activeCards[i], state.activeCards[j]] = [state.activeCards[j], state.activeCards[i]];
            }
            state.currentCardIndex = 0;
            updateTrainerUI();
        }

        // --- UTILS ---
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- EVENTS ---
        document.getElementById('searchInput').addEventListener('input', (e) => {
            state.searchQuery = e.target.value;
            renderDictionary();
        });

        document.getElementById('categoryFilter').addEventListener('change', (e) => {
            state.filterCategory = e.target.value;
            renderDictionary();
        });

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            // Only if trainer is in viewport (simple check)
            const trainerRect = document.getElementById('trainer').getBoundingClientRect();
            const isInView = trainerRect.top < window.innerHeight && trainerRect.bottom > 0;

            if (isInView && document.activeElement.tagName !== 'INPUT') {
                if (e.code === 'ArrowRight') nextCard();
                if (e.code === 'ArrowLeft') prevCard();
                if (e.code === 'Space') {
                    e.preventDefault(); // Prevent scroll
                    flipCard();
                }
            }
        });

        // --- INIT ---
        window.addEventListener('load', () => {
            initChart();
            renderDictionary();
            updateTrainerUI();
        });

    </script>
</body>
</html>
